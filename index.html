<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tra C·ª©u Gi√° ƒê·∫•t H√† N·ªôi 2026</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700;800&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="project.css">
</head>
<body>

    <div class="main-container">
        
        <header class="app-header">
            <div class="brand-wrapper">
                <span class="logo-icon">üèõÔ∏è</span>
                <span style="font-weight: 700; color: var(--primary-dark)">LandPriceVN</span>
            </div>
            <h1>Tra C·ª©u Gi√° ƒê·∫•t <br>H√† N·ªôi 2026</h1>
        </header>

        <!-- Search -->
        <section class="search-section">
            <div class="search-container">
                <div class="search-box-wrapper">
                    <i class="fa-solid fa-magnifying-glass search-icon"></i>
                    <input type="text" id="streetInput" placeholder="Nh·∫≠p t√™n ƒë∆∞·ªùng (v√≠ d·ª•: An D∆∞∆°ng V∆∞∆°ng)..." autocomplete="off">
                    <button id="searchBtn" type="button">Tra C·ª©u Ngay</button>
                </div>
                <!-- Suggestion Dropdown -->
                <ul id="suggestionsList" class="suggestions-list hidden"></ul>
            </div>
        </section>

        <!-- Loading & Status -->
        <section id="statusSection" class="status-section">
            <div class="loader-animation"></div>
            <p style="font-weight: 500; color: var(--text-secondary)" id="statusText">ƒêang kh·ªüi t·∫°o danh s√°ch ƒë∆∞·ªùng ph·ªë...</p>
        </section>

        <!-- Results -->
        <section id="resultsSection" class="results-section hidden">
            <!-- Content injected via JS -->
        </section>
        
        <footer>
            <p>&copy; 2026 HANOI LAND PRICE LOOKUP. All rights reserved.</p>
        </footer>
    </div>

    <script>
        const APPSCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz35xFNhzZvsYuxxpsxQKveGWNaifMJTCgwF7tS4is1AmU4WnLGC_JjYR3x05Qw1ier/exec';

        const searchInput = document.getElementById('streetInput');
        const searchBtn = document.getElementById('searchBtn');
        const resultsSection = document.getElementById('resultsSection');
        const statusSection = document.getElementById('statusSection');
        const statusText = document.getElementById('statusText');
        const suggestionsList = document.getElementById('suggestionsList');

        let uniqueStreetNames = [];

        // 1. Fetch autocomplete list on load
        window.addEventListener('DOMContentLoaded', async () => {
             try {
                // Call action 'list_names' to get lightweight list
                const response = await fetch(`${APPSCRIPT_URL}?action=list_names`);
                if (!response.ok) throw new Error('K·∫øt n·ªëi th·∫•t b·∫°i');
                
                uniqueStreetNames = await response.json();
                
                // Ready
                statusSection.classList.add('hidden');
                
            } catch (error) {
                console.error("Fetch Names Error:", error);
                statusText.innerText = 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch ƒë∆∞·ªùng. Vui l√≤ng reload l·∫°i trang.';
                // Allow user to try searching anyway even if autocomplete fails
            }
        });

        // 2. Input Logic (Autocomplete)
        searchInput.addEventListener('input', () => {
            const query = searchInput.value.toLowerCase().trim();
            if (!query) {
                suggestionsList.classList.add('hidden');
                return;
            }

            // Client-side filter for suggestions
            const matches = uniqueStreetNames.filter(name => 
                name.toLowerCase().includes(query)
            );
            renderSuggestions(matches);
        });

        // 3. Search Logic
        async function performSearch(query) {
            if (!query) return;

            // UI Loading State
            suggestionsList.classList.add('hidden');
            resultsSection.classList.add('hidden');
            statusSection.classList.remove('hidden');
            statusText.innerText = `ƒêang t√¨m ki·∫øm "${query}"...`;

            try {
                // Fetch actual data from server for this street
                const response = await fetch(`${APPSCRIPT_URL}?ten_duong=${encodeURIComponent(query)}`);
                if (!response.ok) throw new Error('Search failed');
                
                const data = await response.json();
                renderResults(data, query);

            } catch (error) {
                console.error("Search Error:", error);
                resultsSection.innerHTML = `<div class="status-section">L·ªói khi t√¨m ki·∫øm. Vui l√≤ng th·ª≠ l·∫°i.</div>`;
                resultsSection.classList.remove('hidden');
            } finally {
                statusSection.classList.add('hidden');
            }
        }

        // Trigger search
        searchBtn.addEventListener('click', () => performSearch(searchInput.value.trim()));
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') performSearch(searchInput.value.trim());
        });

        function renderSuggestions(matches) {
            if (matches.length === 0) {
                suggestionsList.classList.add('hidden');
                return;
            }
            const top = matches.slice(0, 8);
            const html = top.map(name => `
                <li class="suggestion-item">
                    <i class="fa-regular fa-clock"></i> <span>${name}</span>
                </li>
            `).join('');

            suggestionsList.innerHTML = html;
            suggestionsList.classList.remove('hidden');

            document.querySelectorAll('.suggestion-item').forEach(item => {
                item.addEventListener('click', () => {
                    const val = item.querySelector('span').innerText;
                    searchInput.value = val;
                    performSearch(val);
                });
            });
        }

        function renderResults(data, query) {
            resultsSection.classList.remove('hidden');

            if (data.length === 0) {
                resultsSection.innerHTML = `
                    <div class="status-section">
                        <i class="fa-solid fa-inbox" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 16px;"></i>
                        <p style="font-size: 1.1rem; color: #64748b;">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ cho "<strong>${query}</strong>"</p>
                        <p>Vui l√≤ng th·ª≠ l·∫°i v·ªõi t√™n ch√≠nh x√°c h∆°n.</p>
                    </div>
                `;
                return;
            }

            let html = `
                <div class="results-header">
                    <div class="results-count">K·∫øt qu·∫£ tra c·ª©u: <span>${data.length}</span> b·∫£n ghi</div>
                </div>
                <div class="results-grid">
            `;

            html += data.map(item => {
                const get = (k) => item[k] || '';
                const formatPop = (v) => v ? `<span class="price-highlight">${v}</span>` : '-';
                
                const fromP = item['ƒêo·∫°n ƒë∆∞·ªùng - T·ª´'] || item['T·ª´'] || '---';
                const toP = item['ƒêo·∫°n ƒë∆∞·ªùng - ƒê·∫øn'] || item['ƒê·∫øn'] || '---';

                return `
                <div class="land-card">
                    <div class="card-top">
                        <div class="street-title">
                            <i class="fa-solid fa-road" style="color: var(--secondary-color)"></i>
                            ${get('T√™n ƒë∆∞·ªùng ph·ªë')}
                        </div>
                        <span class="location-tag">${get('ƒê·ªãa danh h√†nh ch√≠nh') || 'H√† N·ªôi'}</span>
                    </div>

                    <div class="route-info">
                        <div class="route-point">
                            <span class="point-label"><i class="fa-solid fa-location-dot"></i> ƒêi·ªÉm ƒê·∫ßu</span>
                            <div class="point-value">${fromP}</div>
                        </div>
                        <div class="route-point">
                            <span class="point-label"><i class="fa-solid fa-location-crosshairs"></i> ƒêi·ªÉm Cu·ªëi</span>
                            <div class="point-value">${toP}</div>
                        </div>
                    </div>

                    <div class="price-table-wrapper">
                        <table class="price-table">
                            <thead>
                                <tr>
                                    <th>Lo·∫°i ƒê·∫•t</th>
                                    <th>VT 1</th>
                                    <th>VT 2</th>
                                    <th>VT 3</th>
                                    <th>VT 4</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ƒê·∫•t ·ªû</td>
                                    <td>${formatPop(get('Gi√° ƒë·∫•t ·ªü - VT1'))}</td>
                                    <td>${formatPop(get('Gi√° ƒë·∫•t ·ªü - VT2'))}</td>
                                    <td>${formatPop(get('Gi√° ƒë·∫•t ·ªü - VT3'))}</td>
                                    <td>${formatPop(get('Gi√° ƒë·∫•t ·ªü - VT4'))}</td>
                                </tr>
                                <tr>
                                    <td>TM-DV</td>
                                    <td>${formatPop(get('Gi√° ƒë·∫•t th∆∞∆°ng m·∫°i, d·ªãch v·ª• - VT1'))}</td>
                                    <td>${formatPop(get('Gi√° ƒë·∫•t th∆∞∆°ng m·∫°i, d·ªãch v·ª• - VT2'))}</td>
                                    <td>${formatPop(get('Gi√° ƒë·∫•t th∆∞∆°ng m·∫°i, d·ªãch v·ª• - VT3'))}</td>
                                    <td>${formatPop(get('Gi√° ƒë·∫•t th∆∞∆°ng m·∫°i, d·ªãch v·ª• - VT4'))}</td>
                                </tr>
                                <tr>
                                    <td>SX-KD</td>
                                    <td>${formatPop(get('Gi√° ƒë·∫•t s·∫£n xu·∫•t kinh doanh phi n√¥ng nghi·ªáp kh√¥ng ph·∫£i l√† ƒë·∫•t th∆∞∆°ng m·∫°i d·ªãch v·ª• - VT1'))}</td>
                                    <td>${formatPop(get('Gi√° ƒë·∫•t s·∫£n xu·∫•t kinh doanh phi n√¥ng nghi·ªáp kh√¥ng ph·∫£i l√† ƒë·∫•t th∆∞∆°ng m·∫°i d·ªãch v·ª• - VT2'))}</td>
                                    <td colspan="2" style="text-align:center">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                `;
            }).join('');
            html += '</div>';
            resultsSection.innerHTML = html;
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-container')) {
                suggestionsList.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
